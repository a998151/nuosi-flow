<?xml version="1.0" encoding="UTF-8"?>
<logic-flow id="simple_logic_flow_example"
            name="简单逻辑流程范例"
            desc="简单逻辑流程范例">
    <!-- 全局域 -->
    <define>
        <!-- 引入model定义 -->
        <import model="goods_info"/>
        <var id="goods_type" type="int" name="货物类型">
            <limit max="10"/>
        </var>
        <var id="user_id" type="int" name="用户标识"/>
        <var id="user_name" type="string" name="用户名称"/>
    </define>

    <start id="start" name="开始节点" next="queryGoodsInfo">
        <!-- 逻辑入口参数校验 -->
        <var model="goods_info" attr="goods_name" key="goods_name"/>
        <var id="goods_type" key="goods_type"/>
    </start>

    <action id="queryGoodsInfo" name="查询货物信息" next="switchGoodsInfo">
        <!-- 全局域 -->
        <input>
            <var key="goods_name"/>
            <var key="goods_type"/>
            <var key="user_id" initial="123456"/>
        </input>
        <sql conn="dynamic-form-test">
        <![CDATA[
        SELECT id, goods_name, price, goods_type
            FROM cb_goods
            WHERE goods_name = #{goods_name} and goods_type = #{goods_type};
        ]]>
        </sql>
        <output>
            <var key="goods_infos"/>
        </output>
    </action>

    <action id="switchGoodsInfo" name="查询货物信息" next="printGoods">
        <!-- 全局域 -->
        <input>
            <var key="goods_infos"/>
        </input>
        <if test="INPUT.goods_infos.size==0" next="printGoods"/>
        <!--<if test="INPUT.goods_infos.size>0" next="end"/>-->
    </action>

    <action id="printGoods" name="货物校验" next="end">
        <input>
            <var key="goods_name"/>
            <var key="goods_type"/>
            <var key="user_id" initial="123456"/>
        </input>
        <expression>
            <![CDATA[
            System.out.println("goods_name==="+INPUT.goods_name);
            System.out.println("goods_name==="+DATABUS.goods_name);
            System.out.println("goods_type==="+INPUT.goods_type);
            System.out.println("user_id==="+INPUT.user_id);
        ]]>
        </expression>
        <output>
        </output>
    </action>

    <end id="end" name="结束节点">
        <var key="goods_infos"/>
    </end>
</logic-flow>